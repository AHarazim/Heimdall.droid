<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Heimdall.droid by rheinfabrik</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Heimdall.droid</h1>
      <h2 class="project-tagline">Easy to use OAuth 2 library for Android.</h2>
      <a href="https://github.com/rheinfabrik/Heimdall.droid" class="btn">View on GitHub</a>
      <a href="https://github.com/rheinfabrik/Heimdall.droid/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/rheinfabrik/Heimdall.droid/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="-heimdall" class="anchor" href="#-heimdall" aria-hidden="true"><span class="octicon octicon-link"></span></a>
<img src="https://cloud.githubusercontent.com/assets/460060/8159821/b8bfeb32-136a-11e5-83ed-83b7fe01df3a.jpg" width="30" height="30"> Heimdall</h1>

<p>Heimdall is an <a href="https://tools.ietf.org/html/rfc6749">OAuth 2.0</a> client specifically designed for easy usage and high flexibility. It supports all grants as described in <a href="https://tools.ietf.org/html/rfc6749#section-4">Section 4</a> as well as refreshing an access token as described in <a href="https://tools.ietf.org/html/rfc6749#section-6">Section 6</a> of the <a href="https://tools.ietf.org/html/rfc6749">The OAuth 2.0 Authorization Framework</a> specification.</p>

<p>This library makes use of <a href="https://github.com/ReactiveX/RxAndroid">RxAndroid</a>. Therefore you should be familar with <a href="https://github.com/ReactiveX/RxJava/wiki/Observable">Observables</a>.</p>

<p>If you are an iOS Developer then please take a look at the <a href="https://github.com/rheinfabrik/Heimdall.swift">Swift version of Heimdall</a>.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Heimdall is ready to be used via <a href="https://jitpack.io/#rheinfabrik/Heimdall.droid">jitpack.io</a>.
Simply add the following code to your root <code>build.gradle</code>:</p>

<div class="highlight highlight-groovy"><pre>allprojects {
    repositories {
        jcenter()
        maven { url <span class="pl-s"><span class="pl-pds">"</span>https://jitpack.io<span class="pl-pds">"</span></span> }
    }
}</pre></div>

<p>Now add the gradle dependency in your application's <code>build.gradle</code>:</p>

<div class="highlight highlight-groovy"><pre>dependencies {
    compile <span class="pl-s"><span class="pl-pds">'</span>com.github.rheinfabrik:Heimdall.droid:{latest_version}<span class="pl-pds">'</span></span>
}</pre></div>

<h2>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examples</h2>

<p>Heimdall's main class is the <code>OAuth2AccessTokenManager</code>. It is responsible for retrieving a new access token and keeping it valid by refreshing it.</p>

<p>In order to initialize an <code>OAuth2AccessTokenManager</code> instance, you need to pass an object implementing the <code>OAuth2AccessTokenStorage</code> interface. You can use the predefined <code>SharedPreferencesOAuth2AccessTokenStorage</code> if it suits your needs. Make sure that your <code>OAuth2AccessTokenStorage</code> is as secure as possible!</p>

<div class="highlight highlight-java"><pre>
<span class="pl-k">SharedPreferencesOAuth2AccessTokenStorage&lt;<span class="pl-smi">OAuth2AccessToken</span>&gt;</span> storage <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">SharedPreferencesOAuth2AccessTokenStorage&lt;&gt;</span>(mySharedPreferences, <span class="pl-smi">OAuth2AccessToken</span><span class="pl-k">.</span>class);
<span class="pl-k">OAuth2AccessTokenManager&lt;&gt;</span> manager <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">OAuth2AccessTokenManager&lt;<span class="pl-smi">OAuth2AccessToken</span>&gt;</span>(storage);
</pre></div>

<p>On your manager instance you can now call <code>grantNewAccessToken(grant)</code> to receive a new access token. The grant instance you pass must implement the <code>OAuth2Grant</code> interface and your actual server call. </p>

<p>Here is an example of an <code>OAuth2ResourceOwnerPasswordCredentialsGrant</code>.</p>

<div class="highlight highlight-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyOAuth2Grant</span> <span class="pl-k">extends</span> <span class="pl-e">OAuth2ResourceOwnerPasswordCredentialsGrant&lt;<span class="pl-smi">OAuth2AccessToken</span>&gt;</span> {

    <span class="pl-c">// Constructor</span>

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-k">Observable&lt;<span class="pl-smi">OAuth2AccessToken</span>&gt;</span> <span class="pl-en">grantNewAccessToken</span>() {
        <span class="pl-c">// Create the network request based on the username, the password and the grant type.</span>
        <span class="pl-c">// You can use Retrofit to make things easier.</span>
    }
}</pre></div>

<p>Your manager instance also has a method called <code>getValidAccessToken(refreshGrant)</code>. This is probably the main reason we build this library. It firstly checks if the stored access token is expired and then either emits the unexpired one or refreshs it if it is expired using the passed refresh grant. </p>

<p>Here is an example of an <code>OAuth2RefreshAccessTokenGrant</code>.</p>

<div class="highlight highlight-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyOAuth2Grant</span> <span class="pl-k">extends</span> <span class="pl-e">OAuth2RefreshAccessTokenGrant&lt;<span class="pl-smi">OAuth2AccessToken</span>&gt;</span> {

    <span class="pl-c">// Constructor</span>

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-k">Observable&lt;<span class="pl-smi">OAuth2AccessToken</span>&gt;</span> <span class="pl-en">grantNewAccessToken</span>() {
        <span class="pl-c">// Create the network request based on the grant type and the refresh token.</span>
        <span class="pl-c">// You can use Retrofit to make things easier.</span>
    }
}</pre></div>

<p>Mostly you will use the <code>OAuth2AuthorizationCodeGrant</code> to authorize the user via a third party service such as Trakt.tv.</p>

<p>The implemention of a grant authorizing with Trakt.tv might look as following:</p>

<div class="highlight highlight-java"><pre><span class="pl-k">public</span> <span class="pl-k">final</span> <span class="pl-k">class</span> <span class="pl-en">TraktTVAuthorizationCodeGrant</span> <span class="pl-k">extends</span> <span class="pl-e">OAuth2AuthorizationCodeGrant&lt;<span class="pl-smi">OAuth2AccessToken</span>&gt;</span> {

    <span class="pl-k">public</span> <span class="pl-smi">String</span> clientSecret;

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">Uri</span> <span class="pl-en">buildAuthorizationUri</span>() {
        <span class="pl-k">return</span> <span class="pl-smi">Uri</span><span class="pl-k">.</span>parse(<span class="pl-s"><span class="pl-pds">"</span>https://trakt.tv/oauth/authorize<span class="pl-pds">"</span></span>)
                .buildUpon()
                .appendQueryParameter(<span class="pl-s"><span class="pl-pds">"</span>client_id<span class="pl-pds">"</span></span>, clientId)
                .appendQueryParameter(<span class="pl-s"><span class="pl-pds">"</span>redirect_uri<span class="pl-pds">"</span></span>, redirectUri)
                .appendQueryParameter(<span class="pl-s"><span class="pl-pds">"</span>response_type<span class="pl-pds">"</span></span>, <span class="pl-c1">RESPONSE_TYPE</span>)<span class="pl-k">.</span>build();
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-k">Observable&lt;<span class="pl-smi">OAuth2AccessToken</span>&gt;</span> <span class="pl-en">exchangeTokenForCode</span>(<span class="pl-smi">String</span> <span class="pl-v">code</span>) {
        <span class="pl-c">// Create the network request based on the grant type, clientSecret and the retrieved code.</span>
        <span class="pl-c">// You can use Retrofit to make things easier.</span>
    }
}</pre></div>

<p>Using that grant with an Android WebView might look like this (please note that we use <a href="https://github.com/evant/gradle-retrolambda">Retrolambda</a> here):</p>

<div class="highlight highlight-java"><pre><span class="pl-c">// Create the grant</span>
<span class="pl-smi">TraktTVAuthorizationCodeGrant</span> grant <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">TraktTVAuthorizationCodeGrant</span>();
grant<span class="pl-k">.</span>clientSecret <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>secret<span class="pl-pds">"</span></span>
grant<span class="pl-k">.</span>clientId <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>
grant<span class="pl-k">.</span>redirectUri <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>uri<span class="pl-pds">"</span></span>

<span class="pl-c">// Set up web view loading</span>
webView<span class="pl-k">.</span>setWebViewClient(<span class="pl-k">new</span> <span class="pl-smi">WebViewClient</span>() {

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">onPageFinished</span>(<span class="pl-smi">WebView</span> <span class="pl-v">view</span>, <span class="pl-smi">String</span> <span class="pl-v">url</span>) {
        <span class="pl-v">super</span><span class="pl-k">.</span>onPageFinished(view, url);

        <span class="pl-c">// Tell the grant we loaded an url</span>
        grant<span class="pl-k">.</span>onUrlLoadedCommand<span class="pl-k">.</span>onNext(<span class="pl-smi">Uri</span><span class="pl-k">.</span>parse(url));
    }
});

<span class="pl-c">// Load the authorization url once build</span>
grant<span class="pl-k">.</span>authorizationUri()
    .map(<span class="pl-smi">Uri</span><span class="pl-k">::</span>parse)
    .observeOn(<span class="pl-smi">AndroidSchedulers</span><span class="pl-k">.</span>mainThread())
    .subscribe(myWebView<span class="pl-k">::</span>load)

<span class="pl-c">// Start the authorization process</span>
grant<span class="pl-k">.</span>grantNewAccessToken()
    .subscrive(token <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-smi">Log</span><span class="pl-k">.</span>d(<span class="pl-s"><span class="pl-pds">"</span>Heimdall<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>New token: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> token))
</pre></div>

<h2>
<a id="sample-application" class="anchor" href="#sample-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample Application</h2>

<p>Please also check out our sample application which performs an authorization against <a href="https://trakt.tv/">trakt.tv</a> and displays a simple list of the user's watchlists.</p>

<p><strong>Note:</strong> In order to build the sample by yourself you have to <a href="https://trakt.tv/oauth/applications/new">create a new application on trakt.tv</a> and add the credentials wherever <code>TraktTvAPIConfiguration.java</code> is used.</p>

<h2>
<a id="about" class="anchor" href="#about" aria-hidden="true"><span class="octicon octicon-link"></span></a>About</h2>

<p>Heimdall was built by <a href="http://www.rheinfabrik.de">Rheinfabrik</a> <img class="emoji" title=":factory:" alt=":factory:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f3ed.png" height="20" width="20" align="absmiddle"></p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>Heimdall is licensed under Apache Version 2.0.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/rheinfabrik/Heimdall.droid">Heimdall.droid</a> is maintained by <a href="https://github.com/rheinfabrik">rheinfabrik</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

